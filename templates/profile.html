{% extends "layout.html" %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <div class="bg-white shadow-2xl rounded-3xl overflow-hidden transform hover:scale-105 transition-all duration-300 ease-in-out">
        <div class="md:flex">
            <!-- Sidebar -->
            <div class="md:w-1/3 bg-gradient-to-br from-emerald-400 via-teal-500 to-cyan-600 p-8 relative overflow-hidden">
                <div class="absolute inset-0 bg-white opacity-10 animate-pulse"></div>
                <h2 class="text-4xl font-extrabold mb-8 text-white text-center relative z-10 animate-float">Diet Planner</h2>
                <div class="space-y-6 relative z-10">
                    <div class="flex items-center space-x-4 text-white animate-slideIn">
                        <i class="fas fa-user-circle text-3xl"></i>
                        <span class="text-xl font-semibold">{{ user.username }}</span>
                    </div>
                    <div class="flex items-center space-x-4 text-white animate-slideIn" style="animation-delay: 0.2s;">
                        <i class="fas fa-envelope text-2xl"></i>
                        <span>{{ user.email }}</span>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="md:w-2/3 p-8 bg-gradient-to-br from-gray-50 to-gray-100">
                <h3 class="text-3xl font-bold mb-6 text-gray-800 animate-fadeIn">Your Profile</h3>
                <form id="diet-form" method="POST" action="{{ url_for('profile') }}" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Age -->
                        <div class="relative transform hover:scale-105 transition-all duration-300">
                            <label for="age" class="block text-sm font-medium text-gray-700 mb-1">Age</label>
                            <input type="number" id="age" name="age" value="{{ user.age or '' }}" required
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent shadow-sm">
                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                <i class="fas fa-birthday-cake text-cyan-400"></i>
                            </div>
                        </div>
                        <!-- Height -->
                        <div class="relative transform hover:scale-105 transition-all duration-300">
                            <label for="height" class="block text-sm font-medium text-gray-700 mb-1">Height (cm)</label>
                            <input type="number" id="height" name="height" value="{{ user.height or '' }}" step="0.1" required
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent shadow-sm">
                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                <i class="fas fa-ruler-vertical text-cyan-400"></i>
                            </div>
                        </div>
                        <!-- Weight -->
                        <div class="relative transform hover:scale-105 transition-all duration-300">
                            <label for="weight" class="block text-sm font-medium text-gray-700 mb-1">Weight (kg)</label>
                            <input type="number" id="weight" name="weight" value="{{ user.weight or '' }}" step="0.1" required
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent shadow-sm">
                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                <i class="fas fa-weight text-cyan-400"></i>
                            </div>
                        </div>
                        <!-- Gender -->
                        <div class="transform hover:scale-105 transition-all duration-300">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Gender</label>
                            <div class="flex items-center space-x-6">
                                <label class="inline-flex items-center">
                                    <input type="radio" name="gender" value="Male" {% if user.sex=='Male' %}checked{% endif %}
                                        class="form-radio h-5 w-5 text-cyan-600">
                                    <span class="ml-2 text-gray-700">Male</span>
                                </label>
                                <label class="inline-flex items-center">
                                    <input type="radio" name="gender" value="Female" {% if user.sex=='Female' %}checked{% endif %}
                                        class="form-radio h-5 w-5 text-cyan-600">
                                    <span class="ml-2 text-gray-700">Female</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <!-- Activity Level -->
                    <div class="transform hover:scale-105 transition-all duration-300">
                        <label for="activity_level" class="block text-sm font-medium text-gray-700 mb-1">Activity Level</label>
                        <div class="relative">
                            <input type="range" id="activity_level" name="activity_level" min="1" max="5"
                                value="{{ user.activity_level or '3' }}" class="w-full appearance-none h-2 bg-cyan-200 rounded-full outline-none opacity-70 transition-opacity duration-200 ease-in-out hover:opacity-100">
                            <div class="flex justify-between text-xs text-gray-600 mt-1">
                                <span>Sedentary</span>
                                <span>Lightly Active</span>
                                <span>Moderately Active</span>
                                <span>Very Active</span>
                                <span>Extra Active</span>
                            </div>
                        </div>
                    </div>
                    <!-- Goal -->
                    <div class="transform hover:scale-105 transition-all duration-300">
                        <label for="goal" class="block text-sm font-medium text-gray-700 mb-1">Weight Goal</label>
                        <select id="goal" name="goal" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent shadow-sm">
                            <option value="Maintain weight" {% if user.goal == 'Maintain weight' %}selected{% endif %}>Maintain weight</option>
                            <option value="Weight loss" {% if user.goal == 'Weight loss' %}selected{% endif %}>Weight loss</option>
                            <option value="Extreme weight loss" {% if user.goal == 'Extreme weight loss' %}selected{% endif %}>Extreme weight loss</option>
                            <option value="Weight gain" {% if user.goal == 'Weight gain' %}selected{% endif %}>Weight gain</option>
                        </select>
                    </div>
                    <!-- Meals Per Day -->
                    <div class="transform hover:scale-105 transition-all duration-300">
                        <label for="meals_per_day" class="block text-sm font-medium text-gray-700 mb-1">Meals Per Day</label>
                        <input type="number" id="meals_per_day" name="meals_per_day" min="3" max="6"
                            value="{{ user.meals_per_day or '3' }}" required
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent shadow-sm">
                    </div>
                    <!-- Dietary Preference -->
                    <div class="transform hover:scale-105 transition-all duration-300">
                        <label for="dietary_preference" class="block text-sm font-medium text-gray-700 mb-1">Dietary Preference</label>
                        <select id="dietary_preference" name="dietary_preference"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent shadow-sm">
                            <option value="non-vegetarian" {% if user.dietary_preference == 'non-vegetarian' %}selected{% endif %}>Non-Vegetarian</option>
                            <option value="vegetarian" {% if user.dietary_preference == 'vegetarian' %}selected{% endif %}>Vegetarian</option>
                        </select>
                    </div>
                    <!-- Submit Button -->
                    <button type="submit" id="generateButton"
                        class="w-full bg-gradient-to-r from-cyan-400 to-blue-500 text-white py-3 rounded-lg hover:from-cyan-500 hover:to-blue-600 transition duration-300 ease-in-out transform hover:-translate-y-1 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:ring-opacity-50 shadow-lg">
                        Generate Diet Plan
                    </button>
                </form>
            </div>
        </div>
    </div>

    {% if diet_data %}
    <!-- Diet Plan Section -->
    <div class="mt-12 bg-white shadow-2xl rounded-3xl overflow-hidden animate-fadeIn">
        <div class="bg-gradient-to-r from-cyan-400 to-blue-500 p-8">
            <h2 class="text-3xl font-bold text-white text-center animate-pulse">Your Personalized Diet Plan</h2>
        </div>
        <div class="p-8 bg-gradient-to-br from-gray-50 to-gray-100">
            <!-- BMI Section -->
            <div class="mb-8 p-6 bg-gradient-to-r from-green-100 to-green-50 rounded-lg shadow-inner transform hover:scale-105 transition-all duration-300">
                <h3 class="text-2xl font-semibold mb-4 text-green-800">BMI</h3>
                <p class="text-xl">Your BMI is <span class="font-bold">{{ diet_data.bmi.value }}</span>, which is considered <span class="font-bold text-green-600">{{ diet_data.bmi.category }}</span>.</p>
            </div>

            <!-- Calorie Intake Section -->
            <div class="mb-8 p-6 bg-gradient-to-r from-blue-100 to-blue-50 rounded-lg shadow-inner transform hover:scale-105 transition-all duration-300">
                <h3 class="text-2xl font-semibold mb-4 text-blue-800">Calorie Intake</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {% for plan, calories in diet_data.calories.items() %}
                    <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300 transform hover:scale-105">
                        <p class="font-medium text-lg text-gray-700">{{ plan }}</p>
                        <p class="text-2xl font-bold text-blue-600 mt-2">{{ calories }} kcal</p>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Meal Recommendations Section -->
            <div class="mb-8">
                <h3 class="text-2xl font-semibold mb-6 text-purple-800">Meal Recommendations</h3>
                {% for meal_time, meals in diet_data.meals.items() %}
                <div class="mb-8">
                    <h4 class="text-xl font-bold mb-4 capitalize text-purple-600">{{ meal_time }}</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {% for meal in meals %}
                        {% if meal.name != 'No suitable meal found' %}
                        <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300 transform hover:scale-105">
                            <h5 class="text-lg font-semibold mb-2 text-gray-800">{{ meal.name }}</h5>
                            {% if meal.image %}
                            <img src="{{ meal.image }}" alt="{{ meal.name }}" class="w-full h-48 object-cover rounded mb-4">
                            {% endif %}
                            <div class="text-gray-700 space-y-2">
                                <p><strong>Serving Size:</strong> {{ meal.serving_size }}</p>
                                <p><strong>Preparation Time:</strong> {{ meal.prep_time_in_mins }} minutes</p>
                                <p><strong>Cooking Time:</strong> {{ meal.cook_time_in_mins }} minutes</p>
                                <p><strong>Calories:</strong> {{ meal.energy_per_serving_kcal }} kcal</p>
                                <p><strong>Protein:</strong> {{ meal.protein_per_serving_g }} g</p>
                                <p><strong>Carbohydrates:</strong> {{ meal.carbohydrate_per_serving_g }} g</p>
                                <p><strong>Fat:</strong> {{ meal.fat_per_serving_g }} g</p>
                                <p><strong>Fiber:</strong> {{ meal.fiber_per_serving_g }} g</p>
                                {% if meal.ingredients %}
                                <p><strong>Ingredients:</strong> {{ meal.ingredients }}</p>
                                {% endif %}
                                {% if meal.instructions %}
                                <p><strong>Instructions:</strong> {{ meal.instructions }}</p>
                                {% endif %}
                            </div>
                        </div>
                        {% else %}
                        <p class="text-red-600">No suitable meal found for {{ meal_time }}.</p>
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Calorie Comparison Section -->
            <div class="mb-8 p-6 bg-gradient-to-r from-yellow-100 to-yellow-50 rounded-lg shadow-inner transform hover:scale-105 transition-all duration-300">
                <h3 class="text-2xl font-semibold mb-4 text-yellow-800">Calorie Comparison</h3>
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="mb-4 md:mb-0">
                        <p class="text-xl">Total Calorie Intake: <span class="font-bold text-yellow-600">{{ diet_data.calorie_comparison.total }} kcal</span></p>
                        <p class="text-xl">Maintenance Calories: <span class="font-bold text-yellow-600">{{ diet_data.calorie_comparison.maintenance }} kcal</span></p>
                    </div>
                    <!-- You can add a small chart or infographic here if desired -->
                </div>
            </div>

            <!-- Nutritional Values Section -->
            <div class="mb-8">
                <h3 class="text-2xl font-semibold mb-4 text-pink-800">Nutritional Values</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    {% for nutrient, value in diet_data.nutritional_values.items() %}
                    <div class="bg-white p-6 rounded-lg shadow-md text-center hover:shadow-xl transition-shadow duration-300 transform hover:scale-105">
                        <p class="font-medium text-lg text-gray-700">{{ nutrient }}</p>
                        <p class="text-2xl font-bold text-pink-600 mt-2">{{ value }} g</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<!-- Include Font Awesome for icons -->
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
{% endblock %}

<!-- Loading Overlay -->
<div id="loading-overlay" class="fixed inset-0 bg-gray-900 bg-opacity-50 z-50 flex justify-center items-center hidden">
    <div class="text-center">
        <div class="loader ease-linear rounded-full border-8 border-t-8 border-gray-200 h-24 w-24 mx-auto"></div>
        <p class="mt-6 text-2xl font-semibold text-white">Generating your diet plan...</p>
    </div>
</div>

<style>
    /* Animations */
    @keyframes fade-in {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .animate-fadeIn {
        animation: fade-in 0.5s ease-out;
    }
    @keyframes float {
        0% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
        100% { transform: translateY(0px); }
    }
    .animate-float {
        animation: float 3s ease-in-out infinite;
    }
    @keyframes slideIn {
        from { opacity: 0; transform: translateX(-20px); }
        to { opacity: 1; transform: translateX(0); }
    }
    .animate-slideIn {
        animation: slideIn 0.5s ease-out forwards;
    }
    /* Loader Animation */
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    .loader {
        border-top-color: #4CAF50;
        animation: spin 1s linear infinite;
    }
</style>
